操作系统总结

什么是操作系统：

user view

system view: resource allocator

contrail program

kernel 

操作系统的发展：

没有OS-》单道批处理-》多道批处理-》分时  migration

computer system organic :中断驱动 存储金字塔 caching

硬件保护：dual mode psw mode bit: 1 系统态 0用户态  内存保护base /limit  register

I/O保护  CPU——>timer  系统调用表  系统API放在库函数中 三种方法：寄存器 栈 。。

操作系统的结构: 简单 ->分层  （模块化）      微内核microkernel

![1583996455315](C:\Users\kali_chenye\AppData\Roaming\Typora\typora-user-images\1583996455315.png)







# Review: chapter 1

Computer System components：

- hardware
- operating System
- applications programs
- users

for user view:

- PC Users: an easy-to-use interface for using the hardware
- Mainframe(主机)/Minicomputer Users: maximize the system resource utilization 
- Workstation Users: compromise between individual usability and resource utilization

for System view:

- Resource allocator: allocates and reclaims the system hardware resources to and from user programs 
- Control Program: controls the execution of user programs to prevent errors and improper use of the computer

 common definition : the operating system is the one program running at all times on the computer (i.e., the kernel). All other programs are application programs

all in all, From the computer’s point of view,what is an Operating System：

- A resource allocator, a control program, a kernel

For mainframe systems，the development of systems：

No OS->batch systems->multiprogrammed systems->Time sharing systems

早期操作系统：

- 用户独占全机资源
- 程序运行前准备时间过长
- 人机速度不匹配

solutions：批处理 脱机I/O

## Batch Systems

- Reduce setup time by batching similar jobs 

- Automatic job sequencing –automatically transfers control from one job to another.  First rudimentary operating system. 

- Resident monitor 

  initial control in monitor 
  control transfers to job 
  when job completes control transfers back to monitor

#### simple batch processing(单道批处理)：

- 顺序性：磁带上的各道作业是顺序地 进入内存，各作业的完成顺序与他们 进入内存的顺序相同 

- 单道性:内存中仅有一道程序运行 

- 自动性 

优点：减少了CPU的空闲时间，提高了主机 CPU和I/O设备的使用效率，提高了吞吐量。

缺点：CPU和I/O设备使用忙闲不均

#### Multiprogrammed Batch Systems(多道批处理)：

It’s the first instance where the operating system must **make decisions for the users**

- Keeps several jobs in memory simultaneously 
- Picks and begins to execute one 
- **If that job needs to wait, CPU is switched to another one**

 OS Features Needed for Multiprogramming：

- I/O routine supplied by the system. 
- Memory management
- CPU scheduling
- Allocation of devices
-  File management  

- Job scheduling: the **system must choose** among jobs ready to be brought into memory

Advantages and disadvantages of multiprogramming:

CPU 利用率大大提高
用户无控制权，无交互性，延迟大

#### Time-Sharing Systems–Interactive Computing(分时交互)：

 Interactive computer system provides direct communication between user and the system

 Time-sharing operating system allows many users to share the computer simultaneously

多路性、独占性、交互性、及时性

attention：

-  a job needs to be swapped in and out of memory to the disk (virtual memory). 
- Sophisticated CPU-scheduling schemes are required
- It may ensure that jobs do not get stuck in a deadlock

#### other systems：

Real -Time Systems 实时系统 

Embedded SystemS 嵌入式系统 

Desktop Systems 桌面系统

Parallel Systems 并行系统 

Distributed Systems 分布式系统 

Clustered Systems 

Handheld Systems

## Chapter 2: Computer-System Structures 

![1584064991665](C:\Users\kali_chenye\AppData\Roaming\Typora\typora-user-images\1584064991665.png)

### Computer-System Operation

- I/O devices and the CPU can execute concurrently. 
- Each device controller is in charge of a particular device type. 
- Each device controller has a local buffer
- CPU moves data from/to main memory to/from local buffers 
- I/O is from the device to local buffer of controller. 
- Device controller informs CPU that it has finished its operation by causing an interrupt

### Interrupt

An event that requires the attention of the OS is an interrupt. 

Interrupts may be generated by hardware or software. 

**An interrupt generated by software** (i.e., division by 0) is usually referred to as **a trap. **

**Modern operating systems are interrupt driven**, meaning the OS is in action only if an interrupt occurs.

What is Interrupt driven?

- The OS is activated by an interrupt. 
- The executing program is suspended. 
- Control is transferred to the OS. 
- Program continues when the service completes

#### Interrupt Time Line For a Single Process Doing Output

![1584065098208](C:\Users\kali_chenye\AppData\Roaming\Typora\typora-user-images\1584065098208.png)

#### Common Functions of Interrupts

- Interrupt transfers control to the interrupt service routine generally, through the interrupt vector
- Interrupt architecture must save the address of the interrupted instruction. 
- Incoming interrupts are disabledwhile another interrupt is being processed to prevent a lost interrupt

#### Interrupt Handling

- The operating system preserves the state of the CPU by storing registers and the program counter
- Determines which type of interrupt has occurred: polling  or  vectored interrupt system
- Separate segments of code determine what action should be taken for each type of interrupt

### I/O Structure 

After I/O starts, control returns to user program only upon I/O completion. 

- Wait instruction idles the CPU until the next interrupt 
- Wait loop (contention for memory access). 
- AT: At most one I/O request is outstanding at a time, no simultaneous I/O processing.

After I/O starts, control returns to user program without waiting for I/O completion.

- System call
- Device-status tablecontains entry for each I/O device indicating its type, address, and state. 
- Operating system indexes into I/O device table to determine device status and to modify table entry to include interrupt

![1584066662187](C:\Users\kali_chenye\AppData\Roaming\Typora\typora-user-images\1584066662187.png)

### Direct Memory Access Structure

Only one interrupt is generated per block, rather than the one interrupt per byte.

The CPU gives the DMA controller(1)(2)(3),then the PCU goes back to work

1. disk address
2. memory address
3. a byte count

![1584067122440](C:\Users\kali_chenye\AppData\Roaming\Typora\typora-user-images\1584067122440.png)

### Storage Structure 

### Storage Hierarchy

- registers
- cache
- main memory 
- electronic memory
- magnetic disk
- optical disk
- magnetic tapes

### Hardware Protection

#### Dual-Mode Operation 

Target: ensure that an incorrect program cannot cause other programs to execute incorrectly

Realization: Provide hardware support to differentiate between at least two modes of operations. Mode bitadded to computer hardware to indicate the current mode:  monitor (0) or user (1). 

1.User mode–execution done on behalf of a user.(用 户态或目态)

 2.Monitor mode(also kernel modeor system mode) – execution done on behalf of operating system. (核心态或管态)

**Privileged instructions can be issued only in monitor mode. **

![1584067696550](C:\Users\kali_chenye\AppData\Roaming\Typora\typora-user-images\1584067696550.png)

### I/O Protection

**All I/O instructions are privileged instruction**

Must ensure that a user program could never gain control of the computer in monitor mode 

### Memory Protection 

In order to have memory protection, add two registers that determine the range of legal addresses a program may access: 

- Base register（基址寄存器）–holds the smallest legal physical memory address. 
- Limit register（界限寄存器） –contains the size of the range 

Memory outside the defined range is protected.

**The load instructions for the baseand limit registers are privileged instructions.**

### CPU Protection

Timer–interrupts computer after specified period to ensure operating system maintains control. Timer commonly used to implement time sharing, also used to compute the current time. 

- Timer is decremented every clock tick. 
- When timer reaches the value 0, an interrupt occurs.

**Load-timer is a privileged instruction.**